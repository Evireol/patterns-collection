<?php

// --------------------------------------------------
// 1. –¢–í–û–ô –ò–ù–¢–ï–†–§–ï–ô–° ‚Äî –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
// --------------------------------------------------
interface PaymentGateway
{
    public function charge(string $customerId, float $amount): bool;
}

// --------------------------------------------------
// 2. –¢–í–û–ô –ë–ò–ó–ù–ï–°-–°–ï–†–í–ò–° ‚Äî –æ–Ω –ù–ï –∑–Ω–∞–µ—Ç, –∫–∞–∫–æ–π —à–ª—é–∑ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
// --------------------------------------------------
class SubscriptionService
{
    public function __construct(
        private PaymentGateway $gateway
    ) {}

    public function renewSubscription(string $userId, float $price): void
    {
        echo "üîÅ –ü—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è {$userId} –Ω–∞ {$price} —Ä—É–±...\n";

        $success = $this->gateway->charge($userId, $price);

        if ($success) {
            echo "‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!\n";
        } else {
            echo "‚ùå –û–ø–ª–∞—Ç–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å.\n";
        }
    }
}

// --------------------------------------------------
// 3. –°–¢–û–†–û–ù–ù–ò–ô –ö–õ–ê–°–° (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ SDK Stripe –∏–ª–∏ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)
//    ‚Äî —Ç—ã –ù–ï –º–æ–∂–µ—à—å –µ–≥–æ –º–µ–Ω—è—Ç—å!
// --------------------------------------------------
class ExternalPaymentProcessor
{
    // –û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ: –º–µ—Ç–æ–¥ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥—Ä—É–≥–∏–µ!
    public function processPayment(string $clientToken, int $cents): string
    {
        // –ò–º–∏—Ç–∞—Ü–∏—è: 80% —É—Å–ø–µ—Ö–∞
        $success = (rand(1, 10) <= 8);
        $status = $success ? 'success' : 'failed';

        echo "[EXTERNAL] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è —Ç–æ–∫–µ–Ω–∞ {$clientToken}, —Å—É–º–º–∞: {$cents} —Ü–µ–Ω—Ç–æ–≤ ‚Üí {$status}\n";

        return $status;
    }
}

// --------------------------------------------------
// 4. –ê–î–ê–ü–¢–ï–† ‚Äî —Å–≤—è–∑—ã–≤–∞–µ—Ç ExternalPaymentProcessor —Å —Ç–≤–æ–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
// --------------------------------------------------
class ExternalPaymentAdapter implements PaymentGateway
{
    public function __construct(
        private ExternalPaymentProcessor $processor
    ) {}

    public function charge(string $customerId, float $amount): bool
    {
        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥ —Ñ–æ—Ä–º–∞—Ç –≤–Ω–µ—à–Ω–µ–≥–æ SDK:
        $clientToken = "tok_{$customerId}";     // –ø—Ä–∏–¥—É–º—ã–≤–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ ID
        $cents = (int)($amount * 100);          // —Ä—É–±–ª–∏ ‚Üí —Ü–µ–Ω—Ç—ã

        // –í—ã–∑—ã–≤–∞–µ–º —Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –º–µ—Ç–æ–¥
        $result = $this->processor->processPayment($clientToken, $cents);

        // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ bool
        return $result === 'success';
    }
}

// --------------------------------------------------
// 5. –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –†–ê–ë–û–¢–´
// --------------------------------------------------

// –°–æ–∑–¥–∞—ë–º —Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (–∫–∞–∫ –±—É–¥—Ç–æ –ø–æ–¥–∫–ª—é—á–∏–ª–∏ SDK)
$externalProcessor = new ExternalPaymentProcessor();

// –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –µ–≥–æ –≤ –∞–¥–∞–ø—Ç–µ—Ä
$gateway = new ExternalPaymentAdapter($externalProcessor);

// –ü–µ—Ä–µ–¥–∞—ë–º –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É ‚Äî –æ–Ω–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç –æ –≤–Ω–µ—à–Ω–µ–º SDK!
$subscriptionService = new SubscriptionService($gateway);

// –ü—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É
$subscriptionService->renewSubscription('user_123', 299.90);

echo "\n---\n";

// –ê —Ç–µ–ø–µ—Ä—å –ø—Ä–µ–¥—Å—Ç–∞–≤—å: —Ç—ã –ø–æ–¥–∫–ª—é—á–∞–µ—à—å PayPal!
// –°–æ–∑–¥–∞—ë—à—å PayPalAdapter ‚Äî –∏ –º–µ–Ω—è–µ—à—å —Ç–æ–ª—å–∫–æ —ç—Ç—É —Å—Ç—Ä–æ–∫—É:
// $gateway = new PayPalAdapter(new PayPalClient());
// –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º.

//üîÅ –ü—Ä–æ–±—É–µ–º –ø—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –¥–ª—è user_123 –Ω–∞ 299.9 —Ä—É–±...
//[EXTERNAL] –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ –¥–ª—è —Ç–æ–∫–µ–Ω–∞ tok_user_123, —Å—É–º–º–∞: 29990 —Ü–µ–Ω—Ç–æ–≤ ‚Üí success
//‚úÖ –û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!

//–ò–Ω–æ–≥–¥–∞ –±—É–¥–µ—Ç failed ‚Äî –∏–∑-–∑–∞ —Ä–∞–Ω–¥–æ–º–∞