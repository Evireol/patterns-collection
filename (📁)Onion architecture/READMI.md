# üßÖ Onion Architecture ‚Äî –ö—Ä–∞—Ç–∫–∏–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫

## üìÅ –°–ª–æ–∏ –∏ –∏—Ö –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å

| –°–ª–æ–π | –ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç | –†–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã? | –ü—Ä–∏–º–µ—Ä—ã |
|------|--------------|------------|------------------------|--------|
| **Domain** | –°—É—â–Ω–æ—Å—Ç–∏, –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã** (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã), –∏—Å–∫–ª—é—á–µ–Ω–∏—è | –ù–∏—á–µ–≥–æ | ‚ùå –ù–µ—Ç | `User`, `UserRepositoryInterface`, `UserAlreadyExistsException` |
| **Application** | Use Cases (—Å—Ü–µ–Ω–∞—Ä–∏–∏), DTO, –∫–æ–º–∞–Ω–¥—ã | –¢–æ–ª—å–∫–æ Domain | ‚ùå –ù–µ—Ç | `RegisterUser`, `RegisterUserRequest` |
| **Infrastructure** | –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏–∑ Domain | Domain + –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ | ‚úÖ –î–∞ | `InMemoryUserRepository implements UserRepositoryInterface` |
| **Interfaces** | –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞: HTTP, CLI, –æ—á–µ—Ä–µ–¥—å | Application + Infrastructure | ‚ùå –ù–µ—Ç | `RegisterController.php`, `public/index.php` |

> üîë **–ü—Ä–∞–≤–∏–ª–æ**:  
> **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –í–ù–£–¢–†–¨.**  
> –í–Ω–µ—à–Ω–∏–µ —Å–ª–æ–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ ‚Äî –Ω–∏ –æ—Ç –∫–æ–≥–æ.

---

## ‚ùì –ö—Ç–æ —á—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç?

| –ö–æ–¥ | –ì–¥–µ –∂–∏–≤—ë—Ç? | –ö—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç? |
|-----|------------|----------------|
| `interface X` | `Domain/` | –ù–∏–∫—Ç–æ (—ç—Ç–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç) |
| `class Y implements X` | `Infrastructure/` | –¢–æ–ª—å–∫–æ Infrastructure |
| `function do(X $obj)` | `Application/` | –ù–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç ‚Äî **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç** |
| `new ConcreteX()` | `Interfaces/` | –°–æ–∑–¥–∞—ë—Ç, –Ω–æ **–Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç** |

> ‚úÖ **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –¢–û–õ–¨–ö–û `Infrastructure`.**  
> ‚ùå `Application` –∏ `Interfaces` ‚Äî **–ù–ï —Ä–µ–∞–ª–∏–∑—É—é—Ç**.

---

## üí° –ó–∞—á–µ–º Use Case?

- –≠—Ç–æ **—á–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏—è**: ¬´–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è¬ª.
- –ù–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ HTTP, –ë–î, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏.
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏–∑ Domain** —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (DI).
- –í—ã–∑—ã–≤–∞–µ—Ç –º–µ—Ç–æ–¥—ã —ç—Ç–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ ‚Äî **—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å–Ω–∞—Ä—É–∂–∏**.
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º**: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ HTTP, CLI, –æ—á–µ—Ä–µ–¥–∏ ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π.

```php
// Application/UseCase/RegisterUser.php
public function execute(RegisterUserRequest $request): void
{
    if ($this->repo->findByEmail($request->email)) throw ...;
    $user = new User(...);
    $this->repo->save($user); // ‚Üê –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî –≤ Infrastructure
}