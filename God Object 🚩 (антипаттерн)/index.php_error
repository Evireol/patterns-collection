<?php

// üî• –ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
class UserManager
{
    private $pdo;
    private $mailer;
    private $logger;

    public function __construct()
    {
        // –ñ—ë—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º
        $this->pdo = new PDO('sqlite::memory:');
        $this->mailer = new PHPMailer();
        $this->logger = new Monolog\Logger('app');
    }

    // 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    public function registerUser(string $email, string $name, string $password, string $phone): bool
    {
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {
            $this->logError("Invalid email: $email");
            return false;
        }
        if (strlen($password) < 8) {
            $this->logError("Password too short");
            return false;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ (–∑–∞–ø—Ä–æ—Å –≤ –ë–î)
        $stmt = $this->pdo->prepare("SELECT id FROM users WHERE email = ?");
        $stmt->execute([$email]);
        if ($stmt->fetch()) {
            $this->logError("Email already exists: $email");
            return false;
        }

        // –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è
        $hashedPassword = password_hash($password, PASSWORD_DEFAULT);

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
        $stmt = $this->pdo->prepare("INSERT INTO users (email, name, password, phone) VALUES (?, ?, ?, ?)");
        $success = $stmt->execute([$email, $name, $hashedPassword, $phone]);

        if ($success) {
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ø–∏—Å—å–º–∞
            $this->mailer->setFrom('noreply@example.com');
            $this->mailer->addAddress($email);
            $this->mailer->Subject = 'Welcome!';
            $this->mailer->Body = "Hi $name, welcome to our service!";
            $this->mailer->send();

            $this->logInfo("User registered: $email");
        }

        return $success;
    }

    // 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
    public function updateUser(int $id, array $data): bool
    {
        // ... –µ—â—ë 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∏–∫–∏: –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∑–∞–ø—Ä–æ—Å—ã, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    }

    // 3. –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è + –æ—á–∏—Å—Ç–∫–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    public function deleteUser(int $id): bool
    {
        // ... —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ 5 —Ç–∞–±–ª–∏—Ü, –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
    }

    // 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    public function generateUserReport(): string
    {
        // ... SQL-–∑–∞–ø—Ä–æ—Å, —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CSV, –∑–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    private function logError(string $msg): void { /* ... */ }
    private function logInfo(string $msg): void { /* ... */ }


}    echo "–¢–æ–ª—å–∫–æ –∫–æ–¥.\n";